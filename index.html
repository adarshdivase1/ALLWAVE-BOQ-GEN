<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional AV BOQ Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .premium-glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .virtual-scroll {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        
        .virtual-scroll::-webkit-scrollbar {
            width: 8px;
        }
        
        .virtual-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .virtual-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-connected .status-dot {
            background: #10b981;
        }
        
        .status-disconnected .status-dot {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="text-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-lg font-semibold">Generating Professional BOQ...</p>
            <p class="text-sm text-gray-300 mt-2">Please wait while AI analyzes your requirements</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
                Professional AV BOQ Generator
            </h1>
            <p class="text-xl text-gray-300">AI-Powered Bill of Quantities for Audiovisual Systems</p>
        </header>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Configuration Panel -->
            <div class="lg:col-span-1">
                <div class="control-panel premium-glass rounded-2xl p-6 virtual-scroll">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Project Configuration</h2>
                        <div id="apiStatus" class="status-indicator status-disconnected">
                            <div class="status-dot"></div>
                            <span>Local Mode</span>
                        </div>
                    </div>

                    <!-- Project Details -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Project Name</label>
                            <input type="text" id="projectName" placeholder="Enter project name" 
                                   class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Client Name</label>
                            <input type="text" id="clientName" placeholder="Enter client name" 
                                   class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Room Configuration -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-semibold text-gray-300 mb-2">Width (m)</label>
                                <input type="number" id="roomWidth" value="8" step="0.1" min="3" max="50"
                                       class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-300 mb-2">Depth (m)</label>
                                <input type="number" id="roomDepth" value="6" step="0.1" min="3" max="50"
                                       class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Room Size Category</label>
                            <select id="roomSize" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="small">Small (< 30 sqm)</option>
                                <option value="medium" selected>Medium (30-80 sqm)</option>
                                <option value="large">Large (80-150 sqm)</option>
                                <option value="extra-large">Extra Large (> 150 sqm)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Use Case</label>
                            <select id="useCase" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="meeting">Meeting Room</option>
                                <option value="conference" selected>Conference Room</option>
                                <option value="boardroom">Executive Boardroom</option>
                                <option value="training">Training Room</option>
                                <option value="presentation">Presentation Hall</option>
                                <option value="hybrid">Hybrid Workspace</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Brand Preference</label>
                            <select id="brandPreference" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">No Preference</option>
                                <option value="premium">Premium Brands</option>
                                <option value="enterprise">Enterprise Grade</option>
                                <option value="budget">Cost Effective</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Budget Range</label>
                            <select id="budgetRange" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="economy">Economy (< $50K)</option>
                                <option value="standard" selected>Standard ($50K - $150K)</option>
                                <option value="premium">Premium ($150K - $300K)</option>
                                <option value="enterprise">Enterprise (> $300K)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Special Requirements</label>
                            <textarea id="requirements" rows="3" placeholder="Any special requirements or preferences..." 
                                      class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                        </div>

                        <button onclick="boqGenerator.generateBOQ()" 
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                            Generate Professional BOQ
                        </button>

                        <button onclick="boqGenerator.validateRoomConfiguration()" 
                                class="w-full bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                            Validate Configuration
                        </button>
                    </div>
                </div>
            </div>

            <!-- 3D Visualization -->
            <div class="lg:col-span-2">
                <div class="premium-glass rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-4">
                        3D Room Visualization
                    </h2>
                    <div id="roomVisualization" class="w-full h-96 bg-black/20 rounded-xl overflow-hidden border border-white/10"></div>
                    <div class="flex gap-4 mt-4">
                        <button onclick="boqGenerator.resetView()" 
                                class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition-colors">
                            Reset View
                        </button>
                        <button onclick="boqGenerator.exportVisualization()" 
                                class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition-colors">
                            Export Image
                        </button>
                    </div>
                </div>

                <!-- BOQ Results -->
                <div class="premium-glass rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                            Bill of Quantities
                        </h2>
                        <div class="flex gap-3">
                            <button onclick="boqGenerator.exportBOQ()" 
                                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Export BOQ
                            </button>
                            <button onclick="boqGenerator.clearBOQ()" 
                                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Clear BOQ
                            </button>
                        </div>
                    </div>
                    <div id="boqResults" class="virtual-scroll max-h-96 overflow-y-auto">
                        <div class="text-center py-8 text-gray-400">
                            <p class="text-lg">Generate a BOQ to see results here</p>
                            <p class="text-sm mt-2">Configure your room parameters and click "Generate Professional BOQ"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BOQGenerator {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.room = null;
                this.equipment = [];
                this.boqData = {};
                this.isInitialized = false;
                
                this.initializeAfterLoad();
            }

            initializeAfterLoad() {
                // Wait for DOM to be fully loaded
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        this.initializeVisualization();
                        this.updateApiStatus();
                    });
                } else {
                    this.initializeVisualization();
                    this.updateApiStatus();
                }
            }

            updateApiStatus() {
                const statusElement = document.getElementById('apiStatus');
                if (statusElement) {
                    statusElement.className = 'status-indicator status-disconnected';
                    statusElement.querySelector('span').textContent = 'Local Mode';
                }
            }

            initializeVisualization() {
                try {
                    const container = document.getElementById('roomVisualization');
                    if (!container) {
                        console.error('Room visualization container not found');
                        return;
                    }

                    if (!window.THREE) {
                        console.error('THREE.js not loaded');
                        this.showToast('3D visualization not available - THREE.js failed to load', 'error');
                        return;
                    }
                    
                    this.scene = new THREE.Scene();
                    this.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                    this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    
                    this.renderer.setSize(container.clientWidth, container.clientHeight);
                    this.renderer.setClearColor(0x1a1a2e, 0.8);
                    this.renderer.shadowMap.enabled = true;
                    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                    
                    container.appendChild(this.renderer.domElement);
                    
                    this.setupLighting();
                    this.createRoom();
                    this.camera.position.set(10, 10, 10);
                    this.camera.lookAt(0, 0, 0);
                    
                    this.animate();
                    this.setupMouseControls();
                    
                    this.isInitialized = true;
                    
                    window.addEventListener('resize', () => this.handleResize());
                    console.log('3D visualization initialized successfully');
                    
                } catch (error) {
                    console.error('Error initializing 3D visualization:', error);
                    this.showToast('Failed to initialize 3D visualization', 'error');
                }
            }

            setupLighting() {
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
            }

            createRoom() {
                if (!this.isInitialized) return;
                
                const width = parseFloat(document.getElementById('roomWidth').value) || 8;
                const depth = parseFloat(document.getElementById('roomDepth').value) || 6;
                const height = 3;

                // Remove existing room
                if (this.room) {
                    this.scene.remove(this.room);
                }

                this.room = new THREE.Group();

                // Floor
                const floorGeometry = new THREE.PlaneGeometry(width, depth);
                const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x404040 });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.receiveShadow = true;
                this.room.add(floor);

                // Walls
                const wallMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0x606060, 
                    transparent: true, 
                    opacity: 0.3 
                });

                // Back wall
                const backWallGeometry = new THREE.PlaneGeometry(width, height);
                const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
                backWall.position.set(0, height/2, -depth/2);
                this.room.add(backWall);

                // Front wall
                const frontWall = new THREE.Mesh(backWallGeometry, wallMaterial);
                frontWall.position.set(0, height/2, depth/2);
                frontWall.rotation.y = Math.PI;
                this.room.add(frontWall);

                // Side walls
                const sideWallGeometry = new THREE.PlaneGeometry(depth, height);
                
                const leftWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
                leftWall.position.set(-width/2, height/2, 0);
                leftWall.rotation.y = Math.PI/2;
                this.room.add(leftWall);

                const rightWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
                rightWall.position.set(width/2, height/2, 0);
                rightWall.rotation.y = -Math.PI/2;
                this.room.add(rightWall);

                this.addEquipmentToRoom(width, depth);
                
                this.scene.add(this.room);
            }

            addEquipmentToRoom(width, depth) {
                // Display on front wall
                const displayGeometry = new THREE.BoxGeometry(2, 1.2, 0.1);
                const displayMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
                const display = new THREE.Mesh(displayGeometry, displayMaterial);
                display.position.set(0, 2, -depth/2 + 0.1);
                display.castShadow = true;
                this.room.add(display);

                // Conference table
                const tableGeometry = new THREE.BoxGeometry(width * 0.6, 0.1, depth * 0.4);
                const tableMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const table = new THREE.Mesh(tableGeometry, tableMaterial);
                table.position.set(0, 0.8, 0);
                table.castShadow = true;
                this.room.add(table);

                // Chairs around table
                const chairGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const chairMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                
                for (let i = 0; i < 8; i++) {
                    const chair = new THREE.Mesh(chairGeometry, chairMaterial);
                    const angle = (i / 8) * Math.PI * 2;
                    chair.position.set(
                        Math.cos(angle) * (width * 0.4),
                        0.5,
                        Math.sin(angle) * (depth * 0.3)
                    );
                    chair.castShadow = true;
                    this.room.add(chair);
                }

                // Ceiling speakers
                const speakerGeometry = new THREE.CylinderGeometry(0.15, 0.15, 0.1, 16);
                const speakerMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
                
                const speakerPositions = [
                    [-width/3, 2.9, -depth/3],
                    [width/3, 2.9, -depth/3],
                    [-width/3, 2.9, depth/3],
                    [width/3, 2.9, depth/3]
                ];

                speakerPositions.forEach(pos => {
                    const speaker = new THREE.Mesh(speakerGeometry, speakerMaterial);
                    speaker.position.set(...pos);
                    speaker.castShadow = true;
                    this.room.add(speaker);
                });
            }

            setupMouseControls() {
                if (!this.renderer || !this.renderer.domElement) return;

                let isDragging = false;
                let previousMousePosition = { x: 0, y: 0 };

                this.renderer.domElement.addEventListener('mousedown', (event) => {
                    isDragging = true;
                    previousMousePosition = { x: event.clientX, y: event.clientY };
                });

                this.renderer.domElement.addEventListener('mousemove', (event) => {
                    if (isDragging && this.camera) {
                        const deltaMove = {
                            x: event.clientX - previousMousePosition.x,
                            y: event.clientY - previousMousePosition.y
                        };

                        const spherical = new THREE.Spherical();
                        spherical.setFromVector3(this.camera.position);
                        
                        spherical.theta -= deltaMove.x * 0.01;
                        spherical.phi += deltaMove.y * 0.01;
                        spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                        this.camera.position.setFromSpherical(spherical);
                        this.camera.lookAt(0, 0, 0);

                        previousMousePosition = { x: event.clientX, y: event.clientY };
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                this.renderer.domElement.addEventListener('wheel', (event) => {
                    if (this.camera) {
                        const scale = event.deltaY > 0 ? 1.1 : 0.9;
                        this.camera.position.multiplyScalar(scale);
                        this.camera.position.clampLength(5, 50);
                        event.preventDefault();
                    }
                });
            }

            animate() {
                if (this.renderer && this.scene && this.camera) {
                    requestAnimationFrame(() => this.animate());
                    this.renderer.render(this.scene, this.camera);
                }
            }

            resetView() {
                if (this.camera && this.isInitialized) {
                    this.camera.position.set(10, 10, 10);
                    this.camera.lookAt(0, 0, 0);
                    this.createRoom();
                }
            }

            handleResize() {
                if (!this.camera || !this.renderer) return;
                
                const container = document.getElementById('roomVisualization');
                if (container) {
                    this.camera.aspect = container.clientWidth / container.clientHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(container.clientWidth, container.clientHeight);
                }
            }

            generateBOQ() {
                this.showLoadingOverlay(true);
                
                setTimeout(() => {
                    try {
                        this.generateLocalBOQ();
                        this.showToast('Professional BOQ generated successfully!', 'success');
                    } catch (error) {
                        console.error('Error generating BOQ:', error);
                        this.showToast('Error generating BOQ', 'error');
                    } finally {
                        this.showLoadingOverlay(false);
                    }
                }, 1500); // Simulate processing time
            }

            generateLocalBOQ() {
                const roomWidth = parseFloat(document.getElementById('roomWidth').value);
                const roomDepth = parseFloat(document.getElementById('roomDepth').value);
                const useCase = document.getElementById('useCase').value;
                const budgetRange = document.getElementById('budgetRange').value;

                this.clearBOQ(false);

                const localEquipment = this.getLocalEquipmentList(roomWidth * roomDepth, useCase, budgetRange);
                
                localEquipment.forEach(item => {
                    this.addToBOQ(item);
                });

                this.updateBOQDisplay();
            }

            getLocalEquipmentList(area, useCase, budgetRange) {
                const baseMultiplier = budgetRange === 'premium' ? 1.5 : budgetRange === 'economy' ? 0.7 : 1.0;
                
                return [
                    {
                        name: '4K Display Monitor',
                        brand: 'Samsung',
                        model: 'QM75R',
                        quantity: area > 50 ? 2 : 1,
                        unitPrice: Math.round(3500 * baseMultiplier),
                        category: 'Display Systems',
                        description: '75" 4K UHD professional display with HDR support'
                    },
                    {
                        name: 'Video Conferencing System',
                        brand: 'Logitech',
                        model: 'Rally Plus',
                        quantity: 1,
                        unitPrice: Math.round(2800 * baseMultiplier),
                        category: 'Video Systems',
                        description: 'Ultra-HD ConferenceCam with PTZ camera and speakers'
                    },
                    {
                        name: 'Wireless Presentation System',
                        brand: 'Barco',
                        model: 'ClickShare CX-50',
                        quantity: 1,
                        unitPrice: Math.round(1200 * baseMultiplier),
                        category: 'Presentation Systems',
                        description: 'Wireless presentation and collaboration solution'
                    },
                    {
                        name: 'Audio DSP Processor',
                        brand: 'QSC',
                        model: 'Core 110f',
                        quantity: 1,
                        unitPrice: Math.round(2200 * baseMultiplier),
                        category: 'Audio Processing',
                        description: 'Flexible I/O Core with built-in amplification'
                    },
                    {
                        name: 'Ceiling Speakers',
                        brand: 'Bose',
                        model: 'EdgeMax EM90',
                        quantity: area > 40 ? 6 : 4,
                        unitPrice: Math.round(450 * baseMultiplier),
                        category: 'Audio Systems',
                        description: 'In-ceiling loudspeakers with premium sound quality'
                    },
                    {
                        name: 'Wireless Microphone System',
                        brand: 'Shure',
                        model: 'QLXD124/85',
                        quantity: 2,
                        unitPrice: Math.round(800 * baseMultiplier),
                        'Audio Systems',
                        description: 'Wireless lavalier microphone system with receiver'
                    },
                    {
                        name: 'Control Touch Panel',
                        brand: 'Crestron',
                        model: 'TSW-752',
                        quantity: 1,
                        unitPrice: Math.round(1500 * baseMultiplier),
                        category: 'Control Systems',
                        description: '7" touch screen control panel with Wi-Fi'
                    },
                    {
                        name: 'Matrix Switcher',
                        brand: 'Extron',
                        model: 'IN1808 xi',
                        quantity: 1,
                        unitPrice: Math.round(3200 * baseMultiplier),
                        category: 'Video Distribution',
                        description: '8x8 HDMI matrix switcher with 4K support'
                    },
                    {
                        name: 'Cable Management Kit',
                        brand: 'Panduit',
                        model: 'Professional Kit',
                        quantity: 1,
                        unitPrice: Math.round(800 * baseMultiplier),
                        category: 'Infrastructure',
                        description: 'Complete cable management and conduit solution'
                    },
                    {
                        name: 'Installation & Configuration',
                        brand: 'Professional Services',
                        model: 'Full Setup',
                        quantity: 1,
                        unitPrice: Math.round(5000 * baseMultiplier),
                        category: 'Services',
                        description: 'Professional installation, configuration, and testing'
                    }
                ];
            }

            addToBOQ(item) {
                const category = item.category;
                if (!this.boqData[category]) {
                    this.boqData[category] = [];
                }
                
                item.totalPrice = item.quantity * item.unitPrice;
                this.boqData[category].push(item);
            }

            clearBOQ(updateDisplay = true) {
                this.boqData = {};
                if (updateDisplay) {
                    this.updateBOQDisplay();
                }
            }

            updateBOQDisplay() {
                const boqResults = document.getElementById('boqResults');
                if (!boqResults) return;

                let html = '';
                let grandTotal = 0;

                if (Object.keys(this.boqData).length === 0) {
                    html = `
                        <div class="text-center py-8 text-gray-400">
                            <p class="text-lg">Generate a BOQ to see results here</p>
                            <p class="text-sm mt-2">Configure your room parameters and click "Generate Professional BOQ"</p>
                        </div>
                    `;
                } else {
                    // Project header
                    const projectName = document.getElementById('projectName').value || 'Untitled Project';
                    const clientName = document.getElementById('clientName').value || 'Client Name';
                    
                    html += `
                        <div class="mb-6 p-4 bg-white/5 rounded-lg border border-white/10">
                            <h3 class="text-xl font-bold text-blue-400 mb-2">${projectName}</h3>
                            <p class="text-gray-300">Client: ${clientName}</p>
                            <p class="text-gray-300">Room Dimensions: ${document.getElementById('roomWidth').value}m x ${document.getElementById('roomDepth').value}m</p>
                            <p class="text-gray-300">Use Case: ${document.getElementById('useCase').value}</p>
                        </div>
                    `;

                    Object.keys(this.boqData).forEach(category => {
                        let categoryTotal = 0;
                        const items = this.boqData[category];

                        html += `
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-purple-400 mb-3 border-b border-white/20 pb-2">
                                    ${category}
                                </h3>
                                <div class="space-y-3">
                        `;

                        items.forEach(item => {
                            categoryTotal += item.totalPrice;
                            html += `
                                <div class="bg-white/5 p-4 rounded-lg border border-white/10">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-white">${item.name}</h4>
                                            <p class="text-sm text-gray-400">${item.brand} ${item.model}</p>
                                            <p class="text-sm text-gray-300 mt-1">${item.description}</p>
                                        </div>
                                        <div class="text-right ml-4">
                                            <div class="text-sm text-gray-400">Qty: ${item.quantity}</div>
                                            <div class="text-sm text-gray-400">Unit: $${item.unitPrice.toLocaleString()}</div>
                                            <div class="font-bold text-green-400">$${item.totalPrice.toLocaleString()}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        html += `
                                </div>
                                <div class="text-right mt-3 pt-3 border-t border-white/20">
                                    <span class="text-lg font-semibold text-purple-400">
                                        Category Total: $${categoryTotal.toLocaleString()}
                                    </span>
                                </div>
                            </div>
                        `;

                        grandTotal += categoryTotal;
                    });

                    // Grand total
                    html += `
                        <div class="mt-8 p-6 bg-gradient-to-r from-blue-600/20 to-purple-600/20 rounded-lg border border-blue-500/30">
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold text-white">Grand Total:</span>
                                <span class="text-3xl font-bold text-green-400">$${grandTotal.toLocaleString()}</span>
                            </div>
                            <div class="mt-2 text-sm text-gray-300">
                                *Prices are estimates and may vary based on specific requirements and vendor negotiations
                            </div>
                        </div>
                    `;
                }

                boqResults.innerHTML = html;
            }

            validateRoomConfiguration() {
                const width = parseFloat(document.getElementById('roomWidth').value);
                const depth = parseFloat(document.getElementById('roomDepth').value);
                const area = width * depth;

                let warnings = [];
                let recommendations = [];

                if (width < 3 || depth < 3) {
                    warnings.push('Room dimensions are very small for AV installation');
                }

                if (width / depth > 3 || depth / width > 3) {
                    warnings.push('Room aspect ratio may cause acoustic issues');
                }

                if (area < 20) {
                    recommendations.push('Consider compact solutions for small spaces');
                } else if (area > 100) {
                    recommendations.push('Large room may require additional audio zones');
                }

                let message = 'Room configuration validated successfully!';
                let type = 'success';

                if (warnings.length > 0 || recommendations.length > 0) {
                    message = '';
                    if (warnings.length > 0) {
                        message += 'Warnings: ' + warnings.join(', ') + '. ';
                        type = 'warning';
                    }
                    if (recommendations.length > 0) {
                        message += 'Recommendations: ' + recommendations.join(', ');
                    }
                }

                this.showToast(message, type);
                
                if (this.isInitialized) {
                    this.createRoom();
                }
            }

            exportBOQ() {
                if (Object.keys(this.boqData).length === 0) {
                    this.showToast('No BOQ data to export', 'warning');
                    return;
                }

                try {
                    const projectName = document.getElementById('projectName').value || 'AV_BOQ';
                    let csvContent = "Category,Item,Brand,Model,Description,Quantity,Unit Price,Total Price\n";
                    
                    Object.keys(this.boqData).forEach(category => {
                        this.boqData[category].forEach(item => {
                            csvContent += `"${category}","${item.name}","${item.brand}","${item.model}","${item.description}",${item.quantity},${item.unitPrice},${item.totalPrice}\n`;
                        });
                    });

                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${projectName}_BOQ.csv`;
                    a.click();
                    window.URL.revokeObjectURL(url);

                    this.showToast('BOQ exported successfully!', 'success');
                } catch (error) {
                    this.showToast('Error exporting BOQ', 'error');
                }
            }

            exportVisualization() {
                if (!this.renderer || !this.isInitialized) {
                    this.showToast('3D visualization not available', 'warning');
                    return;
                }

                try {
                    const link = document.createElement('a');
                    link.download = 'room_visualization.png';
                    link.href = this.renderer.domElement.toDataURL();
                    link.click();
                    this.showToast('Visualization exported successfully!', 'success');
                } catch (error) {
                    this.showToast('Error exporting visualization', 'error');
                }
            }

            showLoadingOverlay(show) {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.style.display = show ? 'flex' : 'none';
                }
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the application
        const boqGenerator = new BOQGenerator();

        // Update visualization when room parameters change
        document.addEventListener('DOMContentLoaded', function() {
            const roomWidth = document.getElementById('roomWidth');
            const roomDepth = document.getElementById('roomDepth');
            
            if (roomWidth && roomDepth) {
                roomWidth.addEventListener('input', () => {
                    if (boqGenerator.isInitialized) {
                        boqGenerator.createRoom();
                    }
                });
                
                roomDepth.addEventListener('input', () => {
                    if (boqGenerator.isInitialized) {
                        boqGenerator.createRoom();
                    }
                });
            }
        });
    </script>
</body>
</html>
                        category:
